<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FAROL.IA - Simulador de Entrevista Acessível</title>
    <style>
      :root {
        --dark-blue: #0d1a2e;
        --light-blue: #3a7dff;
        --highlight-blue: #87bfff;
        --white-text: #f0f4f8;
        --gray-text: #b0c4de;
        --border-color: #2a3f5f;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--dark-blue);
        color: var(--white-text);
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .container {
        width: 100%;
        max-width: 900px;
        text-align: center;
      }
      
      .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 40px;
      }
      
      .logo {
        width: 120px;
        height: auto;
        margin-bottom: 20px;
      }

      .title {
        font-size: clamp(2rem, 5vw, 3rem);
        color: var(--white-text);
        margin: 0 0 10px 0;
        font-weight: 700;
      }

      .subtitle {
        font-size: clamp(1.1rem, 3vw, 1.3rem);
        color: var(--gray-text);
        max-width: 500px;
        line-height: 1.6;
        margin: 0;
      }

      .status {
        margin: 20px 0;
        padding: 12px 20px;
        background-color: #1a2c47;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        font-size: 1.1rem;
        display: inline-block;
      }

      .error {
        color: #ff8f8f;
        background-color: #2d1b1b;
        border-color: #5a2d2d;
      }

      .start-button {
        background-color: var(--light-blue);
        color: white;
        border: none;
        padding: 18px 35px;
        font-size: 1.25rem;
        font-weight: 600;
        border-radius: 10px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
        margin-top: 20px;
      }

      .start-button:hover {
        background-color: #5a9dff;
        transform: translateY(-2px);
      }
      
      .start-button:focus-visible {
        outline: 3px solid var(--highlight-blue);
        outline-offset: 3px;
      }

      .hidden {
        display: none;
      }

      .transcripts-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
        text-align: left;
      }

      .transcript-box {
        background-color: #1a2c47;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
      }

      .transcript-box strong {
        color: var(--highlight-blue);
        font-size: 1.1rem;
        display: block;
        margin-bottom: 10px;
      }

      #user-input {
        width: 100%;
        background-color: #0d1a2e;
        color: var(--white-text);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        font-family: inherit;
        font-size: 1.1rem;
        min-height: 100px;
        box-sizing: border-box;
        line-height: 1.6;
      }

      #ai-response {
        min-height: 100px;
        padding: 10px 0;
        font-size: 1.1rem;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>
    <script id="app-data" type="application/json">
      {
        "instructions": {{ instructions | tojson }}
      }
    </script>

    <main 
      class="container" 
      role="main" 
      aria-label="Simulador de Entrevista FAROL.IA"
    >
      <div id="initial-view">
        <header class="header">
           <svg class="logo" viewBox="0 0 100 150" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="logoTitle">
              <title id="logoTitle">Logo FAROL.IA</title>
              <path d="M50 0 L60 20 L40 20 Z" fill="var(--highlight-blue)"/>
              <path d="M40 20 H60 V40 H40 Z" fill="var(--white-text)"/>
              <path d="M45 40 H55 V50 H45 Z" fill="var(--dark-blue)"/>
              <circle cx="50" cy="30" r="4" fill="var(--light-blue)"/>
              <path d="M35 50 H65 L60 140 L40 140 Z" fill="var(--white-text)"/>
              <path d="M40 60 H60 L58 80 H42 Z" fill="var(--light-blue)" opacity="0.7"/>
              <path d="M42 90 H58 L56 110 H44 Z" fill="var(--light-blue)" opacity="0.7"/>
              <path d="M30 140 H70 V150 H30 Z" fill="var(--dark-blue)" stroke="var(--border-color)" stroke-width="2"/>
            </svg>
          <h1 class="title">FAROL.IA</h1>
          <p class="subtitle">Vagas Acessíveis: Conectando Talentos. Removendo Barreiras.</p>
        </header>
        <button id="startButton" class="start-button">Iniciar Entrevista</button>
      </div>
      
      <div id="interview-view" class="hidden">
        <h1 class="title">FAROL.IA — Entrevista em Andamento</h1>
        <div id="status" class="status" aria-live="polite">A iniciar simulação...</div>
        
        <section class="transcripts-container" aria-label="Transcrição da Entrevista">
          <article class="transcript-box" aria-label="Resposta do Recrutador">
            <strong>RECRUTADOR:</strong>
            <p id="ai-response" aria-live="assertive"></p>
          </article>
          <article class="transcript-box" aria-label="Sua Resposta">
            <strong>VOCÊ:</strong>
            <textarea id="user-input" placeholder="Você pode digitar a sua resposta aqui..." aria-label="Caixa de texto para sua resposta"></textarea>
          </article>
        </section>
      </div>
    </main>

    <script>
      const startButton = document.getElementById('startButton');
      const initialView = document.getElementById('initial-view');
      const interviewView = document.getElementById('interview-view');

      const statusDiv = document.getElementById("status");
      const userInput = document.getElementById("user-input");
      const aiResponseDiv = document.getElementById("ai-response");
      
      function updateStatus(message, isError = false) {
        statusDiv.textContent = message;
        statusDiv.classList.toggle('error', isError);
      }
      
      function speakText(text) {
        return new Promise((resolve) => {
            // Cancela falas anteriores para evitar sobreposição
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-BR';
            
            utterance.onstart = () => {
              aiResponseDiv.textContent = text;
            };
            
            utterance.onend = () => {
              resolve();
            };
            
            utterance.onerror = () => {
              resolve(); // Resolve mesmo em caso de erro para não travar a simulação
            };

            window.speechSynthesis.speak(utterance);
        });
      }

      async function runSimulation() {
        const conversationScript = [
          { speaker: 'ai', text: 'Olá, eu sou o FAROL. Agradeço o seu interesse na vaga. A nossa conversa vai durar alguns minutos. Para começar, pode descrever-me um desafio técnico ou de equipe que enfrentou e como o superou?' },
          { speaker: 'user', text: 'Claro. No meu último projeto, tivemos um problema com a performance com uma Inteligência Artificial.' },
          { speaker: 'ai', text: 'Entendido, obrigado por detalhar. E como você abordou a otimização dessa consulta?' },
          { speaker: 'user', text: 'Analisámos o plano de execução e percebemos que faltavam alguns pontos importantes nos prompts. Após isso, o tempo de resposta melhorou em mais de 70%.' },
          { speaker: 'ai', text: 'Interessante sua abordagem. Agora, teria alguma pergunta para mim sobre a vaga?' },
          { speaker: 'user', text: 'Sim, qual é a principal ferramenta de tecnologia que a equipe usa no dia a dia?' },
          { speaker: 'ai', text: 'Ótima pergunta. A nossa equipe usa principalmente o ChatGPT. Agradeço novamente pelo seu tempo. A nossa equipe de RH entrará em contato por e-mail dentro de uma semana.' },
        ];
        
        userInput.value = "";
        aiResponseDiv.textContent = "";

        for (const turn of conversationScript) {
          await new Promise(resolve => setTimeout(resolve, 1500)); 

          if (turn.speaker === 'user') {
            updateStatus('É a sua vez de responder...');
            userInput.value = turn.text;
          } else {
            updateStatus('O recrutador está a falar...');
            aiResponseDiv.textContent = ""; // Limpa o campo da IA antes de ele falar
            await speakText(turn.text);
          }
        }
        
        // INÍCIO DA MODIFICAÇÃO: Redirecionamento para a página de feedback
        updateStatus('Simulação concluída. A redirecionar para o feedback...', false);
        setTimeout(() => {
          // Assumindo que a página de feedback está na rota /feedback
          window.location.href = '/feedback'; 
        }, 2500); // Espera 2.5 segundos antes de redirecionar
        // FIM DA MODIFICAÇÃO
      }

      function startInterview() {
        initialView.classList.add('hidden');
        interviewView.classList.remove('hidden');
        runSimulation();
      }
      
      startButton.addEventListener('click', startInterview);
    </script>
  </body>
</html>
